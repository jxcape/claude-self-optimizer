# /optimize-me

세션 분석 → 깊은 수준 개인화 → 제안 → 승인 후 적용

> **LLM First**: Python은 압축만, 모든 분석/판단/제안은 LLM이 직접 수행

---

## Execution

### Step 1: 세션 데이터 압축

```bash
python3 scripts/compressor.py --limit 100 --days 30
```

출력된 압축 데이터를 **전부 읽어라**.

### Step 2: Knowledge Base 요약 확인

`knowledge/catalog.json` 또는 아래 베스트 프랙티스 참조:

```markdown
## 베스트 프랙티스 요약

### 개발 프랙티스
- TDD: 테스트 먼저 작성 후 구현
- Spec-first: 스펙 문서 먼저 읽고 구현
- Clean architecture: 의존성 역전, 레이어 분리

### 세션 관리
- 한 세션 한 작업 원칙
- 복잡한 작업은 새 세션에서 시작

### 피드백 방식
- 구체적 지시: "X 파일의 Y 함수를 Z로 변경"
- 검증 요청: "빌드 돌려봐", "테스트 통과 확인"
```

### Step 3: 깊은 분석 수행

**금지 - 피상적 분석**:
```
❌ "Read 40%, Edit 30% 사용"
❌ "세션 평균 15턴"
❌ "Python 파일 많이 다룸"
→ 어쩌라고?
```

**필수 - 깊은 분석**:

| 영역 | 분석 내용 |
|------|----------|
| **도메인 파악** | MLOps? 리서치? 웹개발? 프로젝트별 기술 스택? |
| **개발 프랙티스** | TDD 쓰는지? Spec 먼저 읽는지? 빌드/테스트 검증? |
| **작업 패턴** | 세션당 작업 수? 모호한 요청? 실수 패턴 (롤백, 삭제)? |
| **LLM 활용** | 과의존 (체크 없이 완료 선언)? 피드백 방식? |

세션 데이터에서 **구체적 증거**를 찾아라:
- "node 추가해줘" → (구현) → "spec에 없네 삭제" = **실수 패턴**
- "구현했어" → 다음 턴에 "빌드 깨짐" = **검증 누락**
- 같은 요청 3회 반복 = **자동화 후보**

### Step 4: 필요시 CLAUDE.md 참조

세션에 나온 프로젝트의 CLAUDE.md 직접 Read:
- 글로벌: `~/.claude/CLAUDE.md`
- 프로젝트별: 프로젝트 내 `CLAUDE.md`

### Step 5: 제안 생성

```markdown
## 분석 결과

### 도메인
- **주요 프로젝트**: [프로젝트명] ([기술 스택])
- **기술 스택**: [언어], [프레임워크], [도구]

### 발견된 패턴

#### 실수 패턴
- [프로젝트] 구체적 실수 설명 (발생 횟수)
  - 세션: "사용자 발화 인용"

#### 비효율 패턴
- [프로젝트] 비효율 설명
  - 증거: 세션에서 관찰된 내용

#### 좋은 패턴
- [프로젝트] 유지할 패턴

---

## 제안

### P1: 즉시 적용 권장
- [ ] [범위] 규칙 내용
  - 근거: 세션에서 발견한 증거
  - 적용: CLAUDE.md 위치 or Skill 파일

### P2: 고려
- [ ] ...

### P3: 나중에
- [ ] ...
```

### Step 6: 사용자 선택

AskUserQuestion으로 제안 중 적용할 항목 선택:
- `multiSelect: true`로 복수 선택 가능
- 각 제안의 근거와 적용 위치 명시

### Step 7: 적용

승인된 제안을 적용:
1. **diff 미리보기 필수** - 변경 내용 보여주기
2. CLAUDE.md 규칙 → 해당 파일에 추가
3. Skill/Slash → `.claude/skills/` 파일 생성
4. 백업 권장

---

## Usage

```bash
/optimize-me              # 기본 실행 (30일, 100KB)
/optimize-me --days 7     # 최근 7일만
/optimize-me --limit 50   # 50KB로 제한
```

## Safety

- 모든 수정 전 diff 미리보기 필수
- CLAUDE.md 수정 시 백업 권장
- 사용자 승인 후에만 적용
